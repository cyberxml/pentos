#----------------------------------
# Exploit-Database
#----------------------------------

dt=$(date +%Y%j)

# cleanup
rm -rf /opt/pentos/rpmbuild/SOURCES/exploit-database
rm -rf /opt/pentos/rpmbuild/SOURCES/*exploitdb*

# prepare sources
cd /opt/pentos/rpmbuild/SOURCES
git clone https://github.com/offensive-security/exploit-database
mv exploit-database pentos-exploitdb-${dt}
tar --exclude='pentos-exploitdb-${dt}/.git' -cvf pentos-exploitdb-${dt}.tar.gz pentos-exploitdb-${dt}

# make the spec file
rm -f /opt/pentos/rpmbuild/SPECS/pentos-exploitdb.spec
sed -e "s/YYYYDDD/${dt}/" /opt/pentos/rpmbuild/SPECS/pentos-exploitdb.spec.stub > /opt/pentos/rpmbuild/SPECS/pentos-exploitdb.spec
cd /opt/pentos/rpmbuild/SOURCES/pentos-exploitdb-${dt}
find . | sed 's#^\.#/usr/local/pentos/apps/exploitdb#' | egrep -v "/\.git"  >> /opt/pentos/rpmbuild/SPECS/pentos-exploitdb.spec
echo "%changelog" >> /opt/pentos/rpmbuild/SPECS/pentos-exploitdb.spec

# create rpm
cd /opt/pentos
rpmbuild -ba rpmbuild/SPECS/pentos-exploitdb.spec
ls -l /opt/pentos/rpmbuild/RPMS/x86_64/*exploitdb*

# rpm shows many unsatisfied dependencies
# install with nodeps
# rpm --nodeps -i /opt/pentos/rpmbuild/RPMS/x86_64/pentos-exploitdb-YYYYDDD-0.x86_64.rpm


